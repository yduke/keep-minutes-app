<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>输入服务器URL</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <svg t="1755057372291" class="icon logo" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7121" id="mx_n_1755057372291" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M511.089732 134.682445c-250.295602 0.035816-450.689679 41.222867-450.689679 344.530824 0 192.334493 83.395709 279.170211 207.573887 317.065286l0 136.322805 112.136441-114.568339c42.18855 4.256954 85.747363 5.698792 132.217601 5.698792 250.296625-0.036839 452.521472-41.23003 452.521472-344.518544C964.848432 175.906336 761.409894 134.719284 511.089732 134.682445zM337.265866 533.642926c-29.976937 0-54.279408-24.289196-54.279408-54.264904 0-29.975708 24.301448-54.277184 54.279408-54.277184 29.97796 0 54.267128 24.301476 54.267128 54.277184C391.532993 509.352707 367.243826 533.642926 337.265866 533.642926zM511.115316 533.642926c-29.976937 0-54.279408-24.289196-54.279408-54.264904 0-29.975708 24.302471-54.277184 54.279408-54.277184 29.976937 0 54.266104 24.301476 54.266104 54.277184C565.38142 509.352707 541.092252 533.642926 511.115316 533.642926zM684.963742 533.642926c-29.97796 0-54.280431-24.289196-54.280431-54.264904 0-29.975708 24.302471-54.277184 54.280431-54.277184 29.976937 0 54.266104 24.301476 54.266104 54.277184C739.23087 509.352707 714.940679 533.642926 684.963742 533.642926z" p-id="7122" fill="#53c5e7"></path></svg>
    <h3>服务器URL</h3>
    <p class="hint">请输入KeepMinus站点的URL地址</p>
    <p class="hint">必须以http或https开头</p>
    <div id="errorMsg"></div>
    <input id="urlInput" type="text" placeholder="例如：https://example.com">
    <button id="confirmBtn">确认</button>

    <script>
        const urlInput = document.getElementById('urlInput');
        const confirmBtn = document.getElementById('confirmBtn');
        const errorMsg = document.getElementById('errorMsg');
        let hideTimeout = null;

        function validateAndSave() {
            const url = urlInput.value.trim();

            if (!/^https?:\/\//.test(url)) {
                showError('必须以 http 或 https 开头');
                return;
            }
            fetch(url+'/wp-json/km/v1/posts')
                .then(response => {
                    
                    if (response!==null && response.ok) {
                        // console.log(response);
                        window.electronAPI.saveURL(url);
                    }else{
                        showError('非KeepMinus站点');
                        return;
                    }
                })
                .catch(error => {
                    showError('无法连接到该站点');
                    return;
                });

        }

        confirmBtn.addEventListener('click', validateAndSave);

        // 监听回车键提交
        urlInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                validateAndSave();
            }
        });

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            
            if (hideTimeout) clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                errorMsg.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
